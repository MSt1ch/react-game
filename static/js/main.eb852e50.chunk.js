(this["webpackJsonpreact-game"]=this["webpackJsonpreact-game"]||[]).push([[0],{13:function(e,t,n){},15:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),c=n(7),l=n.n(c),s=(n(13),n(8)),u=n(2),i=n(0);function o(e){var t=e.newGameHAndler,n=e.toggleFullScreen,a=e.fullScreenButtonValue,r=e.autoplayHandler;return Object(i.jsxs)("div",{className:"ControlPanel",children:[Object(i.jsx)("input",{type:"button",value:"New Game",className:" controlButton",onClick:function(){return t()}}),Object(i.jsx)("input",{type:"button",value:a,className:" controlButton",onClick:function(){n()}}),Object(i.jsx)("input",{type:"button",value:"Autoplay",className:"controlButton",onClick:function(){return r()}})]})}function d(e){return Object(i.jsxs)("div",{className:"Indicator",children:[Object(i.jsx)("div",{className:"Indicator-Name",children:e.name}),Object(i.jsx)("div",{className:"Indicator-Value",children:e.value})]})}var m="up",f="daown",j="left",v="right",b=100/85*100,h="saved2048Games",O=["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"];function p(e){return(e<10?"0":"")+e.toString()}function g(e){return Object(i.jsxs)("div",{className:"CurrentGameStatistics",children:[Object(i.jsx)(d,{name:"Time",value:"".concat(p(Math.floor(e.gameTime/60)),":").concat(p(e.gameTime%60||0))}),Object(i.jsx)(d,{name:"Moves",value:e.movedCells}),Object(i.jsx)(d,{name:"Merges",value:e.cellMerges}),Object(i.jsx)(d,{name:"Score",value:e.score})]})}function x(e){var t="";switch(e){case 2:t="#eee4da";break;case 4:t="#eee1c9";break;case 8:t="#f3b27a";break;case 16:t="#f69664";break;case 32:t="#f77c5f";break;case 64:t="#f75f3b";break;case 128:t="#edd073";break;case 256:t="#edcc62";break;case 512:t="#edc850";break;case 1024:t="#edc53f";break;case 2048:t="#edc22e";break;default:t="rgba(238, 228, 218, 0.35)"}return t}function S(e,t){switch(e){case v:return t*b;case j:return-t*b;default:return 0}}function V(e,t){switch(e){case f:return t*b;case m:return-t*b;default:return 0}}function w(e){var t=e.gameCells,n=e.isCellAppearance,a=e.transitionDirection,c=e.cellAnimationEndHandler,l=e.cellTransitionEndHandler,s="".concat(100/Math.sqrt(t.length),"%"),u=r.a.useRef(null),o=r.a.useRef(!1),d=r.a.useRef(!1);return o.current=n,d.current=""!==a,Object(i.jsx)("div",{ref:u,className:"GameCanvas",onAnimationEnd:function e(){o.current&&(o.current=!1,c(),u.current&&u.current.removeEventListener("animationend",e))},onTransitionEnd:function e(){d.current&&(d.current=!1,l(),u.current&&u.current.removeEventListener("transitionend",e))},children:t.map((function(e,t){var r=a?e.prevValue:e.curValue,c=""!==a&&0!==e.path,l=2;r&&(r>512?l=1.2:r>64&&(l=1.6));var o={color:null!==r&&r<8?"#776e65":"#f9f6f2",background:x(r),animation:n&&e.prevValue!==e.curValue&&e.curValue&&e.isUpdatedOrNew?"insertNewCells .3s linear":"",transform:c?"translate(".concat(S(a,e.path),"%, ").concat(V(a,e.path),"%)"):"",transition:c?"transform .3s":"",fontSize:"".concat(l,"rem")};return Object(i.jsx)("div",{ref:u,className:"GameCanvas-CellWrapper",style:{width:s,height:s},children:Object(i.jsx)("div",{className:"GameCanvas-CellBackground",children:Object(i.jsx)("div",{className:"GameCanvas-Cell",style:o,children:r})})},t.toString())}))})}function N(e){return Math.round(10*e)/10}function C(e){return Object(i.jsxs)("div",{className:"SettingsWrapper",children:[Object(i.jsx)("div",{className:"settingsPanelName",children:"Settings:"}),Object(i.jsxs)("div",{className:"Parameters",children:[Object(i.jsxs)("div",{className:"Volume parameter",children:[" Volume level",Object(i.jsxs)("div",{className:"settingControls",children:[Object(i.jsx)("input",{type:"button",value:"+",className:"controlButton ",onClick:function(){return e.setVolume((function(e){return e<1?N(e)+.1:1}))}}),p(10*N(e.volume)),Object(i.jsx)("input",{type:"button",value:"-",className:"controlButton",onClick:function(){return e.setVolume((function(e){return e>0?N(e)-.1:0}))}})]}),Object(i.jsx)("input",{type:"button",value:"Sound ".concat(e.isEffectVolumeMuted?"OFF":"ON"),className:"controlButton",onClick:function(){return e.setisEffectVolumeMuted(!e.isEffectVolumeMuted)}}),Object(i.jsx)("input",{type:"button",value:"Music ".concat(e.ismusicVolumeMuted?"OFF":"ON"),className:"controlButton",onClick:function(){return e.setismusicVolumeMuted(!e.ismusicVolumeMuted)}})]}),Object(i.jsxs)("div",{className:"fieldSize parameter",children:[" Field size",Object(i.jsx)("div",{className:"settingControls",children:Object(i.jsxs)("select",{name:"fieldSize",className:"controlButton ",value:e.fieldSize,onChange:function(t){return e.fieldSizeSelecthandler(t.target.value)},children:[Object(i.jsx)("option",{value:3,children:"3"}),Object(i.jsx)("option",{value:4,children:"4"}),Object(i.jsx)("option",{value:5,children:"5"}),Object(i.jsx)("option",{value:6,children:"6"}),Object(i.jsx)("option",{value:7,children:"7"}),Object(i.jsx)("option",{value:8,children:"8"})]})})]}),Object(i.jsxs)("div",{className:"goal parameter",children:[" Current goal",Object(i.jsx)("div",{className:"settingControls",children:Object(i.jsxs)("select",{name:"goal",className:"controlButton ",value:e.goal,onChange:function(t){return e.goalHandler(t.target.value)},children:[Object(i.jsx)("option",{value:16,children:"16"}),Object(i.jsx)("option",{value:32,children:"32"}),Object(i.jsx)("option",{value:64,children:"64"}),Object(i.jsx)("option",{value:128,children:"128"}),Object(i.jsx)("option",{value:256,children:"256"}),Object(i.jsx)("option",{value:512,children:"512"}),Object(i.jsx)("option",{value:1024,children:"1024"}),Object(i.jsx)("option",{value:2048,children:"2048"}),Object(i.jsx)("option",{value:4096,children:"4096"}),Object(i.jsx)("option",{value:8192,children:"8192"}),Object(i.jsx)("option",{value:16384,children:"16384"}),Object(i.jsx)("option",{value:32768,children:"32768"}),Object(i.jsx)("option",{value:65536,children:"65536"})]})})]})]})]})}function M(e){return Object(i.jsxs)("div",{className:"Message",style:{transform:e.isShowMessage?"translate(0%, 750%)":"",opacity:e.isShowMessage?"1":"0"},children:[Object(i.jsx)("div",{className:"MessageTitle",children:e.message}),Object(i.jsx)("input",{type:"button",className:"controlButton",value:"OK",onClick:function(){return e.messageOkHandler()}})]})}var k=n(3),E=n.p+"static/media/points.6a2a0b58.wav",y=n.p+"static/media/move.f1e4d610.wav",A=n.p+"static/media/click.49635200.mp3",I=n.p+"static/media/noChange.df3e968c.flac",T=n.p+"static/media/loose.410bfa26.mp3",B=n.p+"static/media/victory.1806f59f.wav",F=n.p+"static/media/music.7ca942e2.mp3",H=[m,f,j,v];function z(e){return Math.floor(Math.random()*e)}function G(e,t,n){for(var a=[],r=[],c=0;c<e.length;c++)null!==e[c].curValue&&r.push(c);if(r.length!==e.length){for(var l=1;l<=t;l+=1)for(var s=!0;s;){var u=z(Math.pow(n,2));r.includes(u)||(s=!1,r.push(u),a.push({indexForInsert:u,gameCell:Math.floor(10*Math.random())<9?{curValue:2,prevValue:null,isUpdatedOrNew:!0,path:0}:{curValue:4,prevValue:null,isUpdatedOrNew:!0,path:0}}))}a.forEach((function(t){return e[t.indexForInsert]=t.gameCell}))}return e}function U(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,t=2,n=new Array(Math.pow(e,2)).fill({curValue:null,prevValue:null,isUpdatedOrNew:!1,path:0}),a=0;a<n.length;a++)n[a]={curValue:null,prevValue:null,isUpdatedOrNew:!1,path:0};return n=G(n,t,e)}function L(e,t){var n=JSON.parse(JSON.stringify(e));console.log(n===e);var a=!1,r=0,c=0,l=0,s=Math.sqrt(n.length),u=0,i=0,o=0,d=0;switch(t){case m:u=0,d=s-1,i=1,o=s;break;case f:u=n.length-s,d=n.length-1,i=1,o=-s;break;case j:u=0,d=n.length-s,i=s,o=1;break;case v:u=s-1,d=n.length-1,i=s,o=-1}n.forEach((function(e){return e.prevValue=e.curValue}));for(var b=u;b<=d;b+=i){for(var h=[],O=0;O<s;O++)h.push(b+o*O);for(var p=b+o;h.includes(p);p+=o){for(var g=0,x=!0;x;){var S=p-g*o,V=n[S],w=S-o,N=n[w];if(!V||!N||!h.includes(S)||!h.includes(w))break;V.curValue?void 0!==N&&(null===N.curValue||N.curValue===V.curValue&&!1===N.isUpdatedOrNew&&!1===V.isUpdatedOrNew)?(null===N.curValue?N.curValue=V.curValue:(N.curValue=2*N.curValue,N.isUpdatedOrNew=!0,r=+N.curValue,c+=1),V.curValue=null,n[p].path+=1,g+=1,a=!0):x=!1:g+=1}n[p].path>0&&(l+=1)}}return{isArrChanged:a,newArr:n,points:r,cellMerges:c,movedCells:l}}function R(){var e=localStorage.getItem(h);return e?JSON.parse(e):[]}var D=function(e){var t=R();if(0!==t.length)return t[0][e];switch(e){case"gameStartTime":return(new Date).toISOString();case"score":case"cellMerges":case"movedCells":case"gameTime":return 0;case"fieldSize":return 4;case"gameCells":return U();case"goal":return 2048;case"musicVolume":case"efectsVolume":case"volume":return.5;case"isEffectVolumeMuted":case"ismusicVolumeMuted":return!1}};function J(e,t){return-1!==e.findIndex((function(e){return e.curValue===t}))}function q(){var e=r.a.useState(D("gameStartTime")),t=Object(u.a)(e,2),n=t[0],a=t[1],c=r.a.useState(D("score")),l=Object(u.a)(c,2),d=l[0],b=l[1],p=r.a.useState(D("cellMerges")),x=Object(u.a)(p,2),S=x[0],V=x[1],N=r.a.useState(D("movedCells")),q=Object(u.a)(N,2),P=q[0],W=q[1],K=r.a.useState(D("gameTime")),_=Object(u.a)(K,2),Y=_[0],Q=_[1],X=r.a.useState(D("fieldSize")),Z=Object(u.a)(X,2),$=Z[0],ee=Z[1],te=r.a.useState(D("gameCells")),ne=Object(u.a)(te,2),ae=ne[0],re=ne[1],ce=r.a.useState("Open in fullscreen"),le=Object(u.a)(ce,2),se=le[0],ue=le[1],ie=r.a.useState(!0),oe=Object(u.a)(ie,2),de=oe[0],me=oe[1],fe=r.a.useState(""),je=Object(u.a)(fe,2),ve=je[0],be=je[1],he=r.a.useState(!1),Oe=Object(u.a)(he,2),pe=Oe[0],ge=Oe[1],xe=r.a.useState(!1),Se=Object(u.a)(xe,2),Ve=Se[0],we=Se[1],Ne=r.a.useState(D("goal")),Ce=Object(u.a)(Ne,2),Me=Ce[0],ke=Ce[1],Ee=r.a.useState(""),ye=Object(u.a)(Ee,2),Ae=ye[0],Ie=ye[1],Te=r.a.useRef(!1),Be=r.a.useRef(null),Fe=r.a.useState(D("volume")),He=Object(u.a)(Fe,2),ze=He[0],Ge=He[1],Ue=r.a.useState(D("efectsVolume")),Le=Object(u.a)(Ue,2),Re=Le[0],De=Le[1],Je=r.a.useState(D("musicVolume")),qe=Object(u.a)(Je,2),Pe=qe[0],We=qe[1],Ke=r.a.useState(D("isEffectVolumeMuted")),_e=Object(u.a)(Ke,2),Ye=_e[0],Qe=_e[1],Xe=r.a.useState(D("ismusicVolumeMuted")),Ze=Object(u.a)(Xe,2),$e=Ze[0],et=Ze[1],tt=Object(k.a)(E,{volume:Re}),nt=Object(u.a)(tt,1)[0],at=Object(k.a)(y,{volume:Re}),rt=Object(u.a)(at,1)[0],ct=Object(k.a)(A,{volume:Re}),lt=Object(u.a)(ct,1)[0],st=Object(k.a)(I,{volume:Re}),ut=Object(u.a)(st,1)[0],it=Object(k.a)(T,{volume:Re}),ot=Object(u.a)(it,1)[0],dt=Object(k.a)(B,{volume:Re}),mt=Object(u.a)(dt,1)[0],ft=Object(k.a)(F,{volume:Pe}),jt=Object(u.a)(ft,2),vt=jt[0],bt=jt[1].isPlaying;r.a.useEffect((function(){De(Ye?0:ze),We($e?0:ze)}),[ze,Ye,$e]);var ht=r.a.useCallback((function(e){if(console.log(e),Te.current){Te.current=!1;var t=function(e){switch(e){case"ArrowUp":return m;case"ArrowDown":return f;case"ArrowRight":return v;case"ArrowLeft":return j;default:return""}}(e.key);if(H.includes(t)){var n=L(ae,t),a=n.isArrChanged,r=n.newArr,c=n.points,l=n.cellMerges,u=n.movedCells;a?(re(Object(s.a)(r)),be(t),b((function(e){return e+c})),V((function(e){return e+l})),W((function(e){return e+u})),c?nt():rt()):J(ae,null)?(re(G(ae,1,Math.sqrt(ae.length))),me(!0),ut()):!function(e){for(var t=0;t<H.length;t++)if(L(e,H[t]).isArrChanged)return!0;return!1}(ae)?(Ie("You loose (no available moves)"),we(!0),ot(),Te.current=!0):(ut(),Te.current=!0)}}}),[ae,nt,rt,ut,ot]),Ot=r.a.useCallback((function(){lt(),me(!0),a((new Date).toISOString()),b(0),V(0),W(0),Q(0),re(U($))}),[$,lt]);return r.a.useEffect((function(){Te.current=!0}),[]),r.a.useEffect((function(){vt()}),[vt,bt]),r.a.useEffect((function(){return console.log("mouse event effect"),window.addEventListener("keydown",ht),function(){return window.removeEventListener("keydown",ht)}}),[ht]),r.a.useEffect((function(){var e=setInterval((function(){return Q((function(e){return Math.floor(e+1)}))}),1e3);return function(){return clearInterval(e)}}),[n]),r.a.useEffect((function(){var e;if(pe){e=setInterval((function(){return window.dispatchEvent(new KeyboardEvent("keydown",{key:O[z(4)]}))}),1e3)}return function(){return clearInterval(e)}}),[pe]),Object(i.jsxs)("div",{ref:Be,className:"GameField",children:[Object(i.jsx)(M,{isShowMessage:Ve,message:Ae,messageOkHandler:function(){Ie(""),we(!1)}}),Object(i.jsx)(C,{volume:ze,setVolume:Ge,musicVolume:Pe,setmusicVolume:We,isEffectVolumeMuted:Ye,setisEffectVolumeMuted:Qe,ismusicVolumeMuted:$e,setismusicVolumeMuted:et,fieldSize:$,fieldSizeSelecthandler:function(e){ee(e)},goal:Me,goalHandler:function(e){ke(e)}}),Object(i.jsx)(o,{newGameHAndler:function(){ge(!1),Ot()},toggleFullScreen:function(){lt(),document.fullscreenElement?(document.exitFullscreen(),ue("Open in fullscreen")):null!==Be.current&&(Be.current.requestFullscreen(),ue("Close fullscreen"))},fullScreenButtonValue:se,autoplayHandler:function(){pe||Ot(),ge(!pe)}}),Object(i.jsx)(g,{score:d,cellMerges:S,movedCells:P,gameTime:Y}),Object(i.jsx)(w,{gameCells:ae,isCellAppearance:de,transitionDirection:ve,cellAnimationEndHandler:function(){me(!1),re(ae.map((function(e){return e.prevValue=null,e.isUpdatedOrNew=!1,e.path=0,e}))),function(e,t,n,a,r,c,l,s,u,i,o,d,m){var f={gameCells:e,score:t,cellMerges:n,movedCells:a,gameTime:r,volume:c,fieldSize:l,gameStartTime:s,goal:u,isEffectVolumeMuted:i,ismusicVolumeMuted:o,efectsVolume:d,musicVolume:m},j=R();j.length>9&&j.pop(),j.unshift(f),localStorage.setItem(h,JSON.stringify(j))}(ae,d,S,P,Y,ze,$,n,Me,Ye,$e,Re,Pe),J(ae,Number(Me))&&(mt(),pe?(ge(!1),Ie("Wow, autoplay reach ".concat(Me,"!"))):Ie("Goal ".concat(Me," reached! Try change goal and continue")),we(!0)),Te.current=!0},cellTransitionEndHandler:function(){re(G(ae,1,Math.sqrt(ae.length))),me(!0),be("")}})]})}var P=n.p+"static/media/rs_school_js.ad178c0d.svg",W=n.p+"static/media/github.8eebd666.png";function K(){return Object(i.jsxs)("footer",{children:[Object(i.jsx)("a",{href:"https://rs.school/js/",target:"blank",children:Object(i.jsxs)("div",{children:[Object(i.jsx)("img",{src:P,alt:"schoolLogo"}),"RSS-School"]})}),Object(i.jsx)("a",{href:"https://github.com/thrvrce/react-game",target:"blank",children:Object(i.jsxs)("div",{children:[Object(i.jsx)("img",{src:W,alt:"githubLogo"}),"Viktor Avdeev"]})}),Object(i.jsx)("div",{children:"2021"})]})}l.a.render(Object(i.jsx)(r.a.StrictMode,{children:Object(i.jsxs)("div",{className:"mainContent",children:[Object(i.jsx)(q,{}),Object(i.jsx)(K,{})]})}),document.getElementById("root"))}},[[15,1,2]]]);
//# sourceMappingURL=main.eb852e50.chunk.js.map